<html>
  <body>
    <center>
      <p>
        <H3 id="message3"></H3>
        <h3>Below is the 10 bit PNG image with Linear gamma profile
        <a
          href="https://github.com/ellelstone/elles_icc_profiles/blob/master/profiles/Rec2020-elle-V4-g10.icc"
          >Rec2020-elle-V4-g10.icc</a
        ></h3>
        <br />
        The below image has 16 stripes [ 4 of each color ] that consists of alternating 
        pixels with values A and B(dithered stripe). Next to each of them we have another 
        16 stripes in which all the pixels are set to (A+B)/2(solid stripe). Since the 
        image is linear, the optically averaged dithered stripe is physically
        identical to the solid stripe. if there is any nonlinearity then, most
        likely, the two stripes would have been physically different and the
        difference would have been apparent as a difference in brightness.
      </p>
    
    <img id="image" src="image.png" height="540" />
    <hr>
    <h3><span id="message1"></span></h3>
    <p id="message0"></p>
    <p id="message2"></p>
    <video id="output-video" controls autoplay height="540"></video>
    
    </center>
    <script src="https://cdn.jsdelivr.net/npm/remote-calibrator@latest"></script>
    <script>
      const message0 = document.getElementById("message0");
      const message1 = document.getElementById("message1");
      const video = document.getElementById("output-video");
      const message2 = document.getElementById("message2");
      const message3 = document.getElementById("message3"); 

      const isHVC1Supported = MediaSource.isTypeSupported(
        'video/mp4; codecs="hvc1"'
      );
      const isAVC1Supported = MediaSource.isTypeSupported(
        'video/mp4; codecs="avc1.6e0033"'
      );
      RemoteCalibrator.init({ id: "session_022" });
      message3.innerHTML = " <u>[ Browser Detected : <b> " + RemoteCalibrator.browser.value + "</b> ] </u> ";
      if (isHVC1Supported == true) {
        //safari video
        message0.innerHTML = "HVC1 codec is supported by the browser (Checked using MediaSource.isTypeSupported) with following configuration :"
        message1.innerHTML =
          "Below is the HDR video generated from this image using H.265 Codec with <a target='_blank' href='https://github.com/ffmpegwasm/ffmpeg.wasm'>ffmpeg.wasm</a>";
        video.src = "safari_video.mp4";
        var msg =
          "hvc1 compiled using <b><u>libx265</b></u> codec with <b><u>yuv420p10le</u></b> pixel format, <br>";
        msg +=
          "color_range=pc, colorprim=bt2020, transfer=smpte2084, colormatrix=bt2020nc";
        msg += "<br> Currently it seems the video generated with H.265 codec is changing the color profile of the video while conversion. "
        msg += "<br>Please try using Chrome for now as the codec H.264 which is generating correct video is not playable in Safari."
        message2.innerHTML = msg;
        console.log(msg);
      } else if (isAVC1Supported == true) {
        //chrome video
        message0.innerHTML = "HVC1 codec is not supported by the browser, so using AVC1 (Checked using MediaSource.isTypeSupported) with following configuration : "
        message1.innerHTML =
          "Below is the HDR video generated from this image using H.264 Codec with <a target='_blank' href='https://github.com/ffmpegwasm/ffmpeg.wasm'>ffmpeg.wasm</a>";
        video.src = "chrome_video.mp4";
        var msg =
          "avc1 compiled using <b><u>libx264</b></u> codec with <b><u>yuv420p10le</u></b> pixel format, <br>";
        msg +=
          "color_range=pc, colorprim=bt2020, transfer=smpte2084, colormatrix=bt2020nc";
        message2.innerHTML = msg;
        console.log(msg);
      } else {
        message1.innerHTML =
          " Both hvc1 codec and avc1.6e0033 codec are not supported by your browser. Please use CHROME or SAFARI ";
      }
    </script>
  </body>
</html>
