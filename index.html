<html>
  <body>
    <h2>LINEARITY TEST OF HDR10 MOVIE FOR EASYEYES.APP</h2>
    <h3>Evaluating HDR10 as a way to present 10-bit spatiotemporal stimuli.</h3>
    <p>
      Rajat Raghuwanshi and Denis G. Pelli <br />New York University <br />April
      29, 2022
    </p>
    <h3>
      OVERVIEW : We designed a special test pattern, explained below, to
      visually assess the linearity of image display. We show it first as JPG
      and 16-bit PNG images, and then as a static HDR10 movie. In limited
      testing, Safari uses color management to display both JPG and PNG
      correctly. Chrome seems to do color management only on JPG, not PNG. Both
      browsers show the HDR10 movie correctly, with no visible artifact.
    </h3>
    <p style="font-size: large; font-weight: bold" id="message3"></p>
    <p style="font-size: larger">
      <span style="font-weight: bold">A 16 bit PNG image</span> with linear
      gamma profile
      <a
        href="https://github.com/ellelstone/elles_icc_profiles/blob/master/profiles/Rec2020-elle-V4-g10.icc"
        >Rec2020-elle-V4-g10.icc</a
      >
    </p>
    <p style="max-width: 960px">
      The PNG image has four colored vertical bands: Red Green Blue Gray. Each
      colored band consists of four repetitions of a pair of stripes. That pair
      consists of a solid and a dithered stripe. All the solid stripe pixels are
      set to 0.5 of the relevant RGB components. The matching dithered stripe
      alternates pixels that are brighter or darker than 0.5, so that if they
      are optically averaged the mean will match that of the solid stripe. The
      dither contrast is 100% at the top (e.g. for gray we alternate black and
      white) and fades linearly to 0% at the bottom (identical to the solid
      stripe). The linear gamma of the image, with correct color management of
      the display will result in the dithered and solid stripes being identical
      after optical blur. But the dither should be visible through a microscope.
    </p>
    <img id="image" src="image.png" />
    <hr />
    <h3><span id="message1"></span></h3>
    <div><span id="message0"></span><span id="message2"></span></div>

    <video id="output-video" controls autoplay></video>
    <script src="https://cdn.jsdelivr.net/npm/remote-calibrator@latest"></script>
    <script>
      const message0 = document.getElementById("message0");
      const message1 = document.getElementById("message1");
      const video = document.getElementById("output-video");
      const message2 = document.getElementById("message2");
      const message3 = document.getElementById("message3");

      const isHVC1Supported = MediaSource.isTypeSupported(
        'video/mp4; codecs="hvc1"'
      );
      const isAVC1Supported = MediaSource.isTypeSupported(
        'video/mp4; codecs="avc1.6e0033"'
      );
      RemoteCalibrator.init({ id: "session_022" });
      message3.innerHTML =
        " Browser detected: " + RemoteCalibrator.browser.value;
      if (isHVC1Supported == true) {
        //safari video
        message0.innerHTML =
          "MediaSource.isTypeSupported says that the browser supports the HVC1 codec. Using the following configuration: ";
        message1.innerHTML =
          "The Video generated by <a target='_blank' href='https://github.com/ffmpegwasm/ffmpeg.wasm'>ffmpeg.wasm</a> from the PNG image using H.265 Codec ";
        video.src = "safari_video.mp4";
        var msg =
          "<br>hvc1 compiled using <u>libx265</u> codec with <u>yuv444p10le</u> pixel format,";
        msg += " colorprim=bt2020, transfer=linear, colormatrix=bt2020nc";
        msg +=
          "<br> Safari supports only the H.265, not the older H.264 codec. ";
        message2.innerHTML = msg;
        console.log(msg);
      } else if (isAVC1Supported == true) {
        //chrome video
        message0.innerHTML =
          "MediaSource.isTypeSupported says that HVC1 codecs is not supported by your browser, so using AVC1 with the following configuration : ";
        message1.innerHTML =
          "The Video generated by <a target='_blank' href='https://github.com/ffmpegwasm/ffmpeg.wasm'>ffmpeg.wasm</a> from the PNG image using H.264 Codec ";
        video.src = "chrome_video.mp4";
        var msg =
          "<br>avc1 compiled using <u>libx264</u> codec with <u>yuv444p10le</u> pixel format,";
        msg += " colorprim=bt2020, transfer=linear, colormatrix=bt2020nc";
        message2.innerHTML = msg;
        console.log(msg);
      } else {
        message1.innerHTML =
          "Both hvc1 codec and avc1.6e0033 codec are not supported by your browser. Please use CHROME or SAFARI ";
      }
    </script>
  </body>
</html>
